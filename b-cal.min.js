/**
 * @page        http://github.com/Shushik/b-cal/
 * @author      Shushik <silkleopard@yandex.ru>
 * @version     2.0
 * @description a simple javascript calendar
 *
 * @constructor
 *
 * @this    {Cal}
 * @param   {DOMNode}
 * @param   {DOMNode}
 * @param   {Object}
 * @param   {Object}
 * @returns {Cal}
 */
;(function(){var i=function(c,b,a,d){this._id="";this.shown=!1;this._lang={hide:"hide",week:"Mo Tu We Th Fr Sa Su".split(" "),month:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")};this._loaded={};this._data={prev:null,curr:null,next:null};this._stable={min:null,max:null,now:null};this._moving={min:null,max:null,now:null};this._nodes={cal:null,days:null,prev:null,next:null,tail:null,month:null,target:null};this._handlers={click:function(){}};this.init(c,b,a,d);return this};i.prototype= {init:function(c,b,a,d){var b=b||!1,c=c||{},a=a||document.body,d=d||{},e="";this._nodes.target=a;if(b)for(e in this._lang)this._lang[e]=b[e];for(e in d)this._handlers[e]=d[e];this.preset(c)._create();return this},_inside:function(c,b,a){return c>b&&c<a?!0:!1},_count:function(){var c=42,b=null,a=null,a=null;this._data.prev=null;this._data.next=null;b=this._data.curr={};b.raw=new Date(this._moving.now);b.month=b.raw.getMonth();b.year=b.raw.getFullYear();b.till=(new Date(b.year,b.month+1,0)).getDate(); b.from=1;b.beg=(new Date(b.year,b.month,1)).getDay();b.end=(new Date(b.year,b.month,b.till)).getDate();0==b.beg&&(b.beg=7);c-=b.till;a=this._data.prev={};a.raw=new Date(b.year,b.month-1);a.month=a.raw.getMonth();a.year=a.raw.getFullYear();a.till=(new Date(a.year,b.month,0)).getDate();a.from=a.till-(b.beg-2);c-=b.beg;a=this._data.next={};a.raw=new Date(b.year,b.month+1);a.month=a.raw.getMonth();a.year=a.raw.getFullYear();a.till=c+1;a.from=1;return this},_create:function(){var c=0,b="",a=null,d=null, e=this,j=null,f=null,h=null,d=document.createElement("div");d.className="b-cal__tail-in";j=document.createElement("div");j.className="b-cal__tail-out";f=document.createElement("div");f.className="b-cal__hide";f.innerHTML=this._lang.hide;a=this._nodes.cal=document.createElement("div");a.className="b-cal";this._nodes.prev=document.createElement("div");this._nodes.prev.className="b-cal__prev";this._nodes.next=document.createElement("div");this._nodes.next.className="b-cal__next";this._nodes.month=document.createElement("div"); this._nodes.month.className="b-cal__month";this._nodes.days=document.createElement("div");this._nodes.days.className="b-cal__days";this._nodes.week=document.createElement("div");this._nodes.week.className="b-cal__week";for(c=0;7>c;c++)h=document.createElement("div"),h.className="b-cal__weekday",h.innerHTML=this._lang.week[c],this._nodes.week.appendChild(h);a.appendChild(j);a.appendChild(d);a.appendChild(this._nodes.month);a.appendChild(this._nodes.prev);a.appendChild(this._nodes.next);a.appendChild(this._nodes.week); a.appendChild(this._nodes.days);a.appendChild(f);this._nodes.target.appendChild(a);for(b in this._handlers)a.addEventListener?a.addEventListener(b,function(a){e._live(b,a)}):a.attachEvent&&a.attachEvent("on"+b,function(){e._live(b,window.event)});return this},_draw:function(c){this.set(c||!1);var b=!1,c=!1,a=0,d=0,e=0,j=this._lang,f=this._data,b=f.prev,h=f.curr,f=f.next,a=this._moving,i=this._stable,k=this._loaded.holidays,l=a.min,m=a.max,g=this._nodes,n=h.year,o=h.month,p=n+"-"+o+"-";g.days.innerHTML= "";g.month.innerHTML=j.month[h.month]+" "+h.year;i.now.getFullYear()==n&&i.now.getMonth()==o&&(e=i.now.getDate());a.chosen&&(a.chosen.month==o&&a.chosen.year==n)&&(d=a.chosen.day);if(1<h.beg)for(a=b.from;a<=b.till;a++)node=document.createElement("div"),node.innerHTML=a,this._inside(new Date(b.year,b.month,a),l,m)?(c=!0,node.className="b-cal__day b-cal__day_in_past"):node.className="b-cal__day b-cal__day_is_disabled",k&&k[b.year+"-"+b.month+a]&&(node.className+=" b-cal__day_is_holiday"),g.days.appendChild(node); else this._inside(new Date(b.year,b.month,b.from),l,m)&&(c=!0);c?(g.prev.title=j.month[b.month]+" "+b.year,g.prev.className="b-cal__prev b-cal__prev_is_enabled",c=!1):(g.prev.title="",g.prev.className="b-cal__prev b-cal__prev_is_disabled");for(a=h.from;a<=h.till;a++)node=document.createElement("div"),b=this._inside(new Date(n,o,a),l,m),node.innerHTML=a,node.className=d==a?"b-cal__day b-cal__day_is_chosen":e==a?"b-cal__day b-cal__day_in_presence":b?"b-cal__day b-cal__day_is_enabled":"b-cal__day b-cal__day_is_disabled", k&&k[p+a]&&(node.className+=" b-cal__day_is_holiday"),g.days.appendChild(node);if(0<f.till)for(a=f.from;a<=f.till;a++)node=document.createElement("div"),node.innerHTML=a,this._inside(new Date(f.year,f.month,a),l,m)?(c=!0,node.className="b-cal__day b-cal__day_in_future"):node.className="b-cal__day b-cal__day_is_disabled",k&&k[f.year+"-"+f.month+"-"+a]&&(node.className+=" b-cal__day_is_holiday"),g.days.appendChild(node);c?(g.next.title=j.month[f.month]+" "+f.year,g.next.className="b-cal__next b-cal__next_is_enabled"): (g.next.title="",g.next.className="b-cal__next b-cal__next_is_disabled")},_live:function(c,b){var a=navigator.userAgent.match(/opera/ig)?!0:!1;!a&&b.srcElement&&(b.target=b.srcElement);!a&&3==b.target.nodeType&&(b.target=b.target.parentNode);var a=this._data.curr,d=b.target,e=d.className,d=d.innerHTML;if(e)switch(e){case "b-cal__prev b-cal__prev_is_enabled":case "b-cal__day b-cal__day_in_past":case "b-cal__day b-cal__day_in_past b-cal__day_is_holiday":this.prev();break;case "b-cal__next b-cal__next_is_enabled":case "b-cal__day b-cal__day_in_future":case "b-cal__day b-cal__day_in_future b-cal__day_is_holiday":this.next(); break;case "b-cal__hide":this.set().hide();break;case "b-cal__day b-cal__day_is_enabled":case "b-cal__day b-cal__day_is_enabled b-cal__day_is_holiday":case "b-cal__day b-cal__day_in_presence":case "b-cal__day b-cal__day_in_presence b-cal__day_is_holiday":this._handlers.click(b.target,b,new Date(a.year,a.month,d)),this._moving.chosen={year:a.year,month:a.month,day:d},this._draw({now:new Date(a.year,a.month,d)})}},preset:function(c){var c=c||{},b=[],a={now:new Date,min:null,max:null};a.min=new Date(a.now.getFullYear(), a.now.getMonth(),a.now.getDate()-1);a.max=new Date(a.now.getFullYear()+1,a.now.getMonth(),a.now.getDate());for(alias in this._stable)c[alias]?(b=c[alias].split(" "),this._stable[alias]=new Date(b[0],b[1]-1,b[2])):this._stable[alias]=a[alias];return this},reset:function(){return this.set()},set:function(c){var b=this._moving,a=this._stable,d=c||{};!c&&b.chosen&&delete b.chosen;for(alias in b)d[alias]?b[alias]=d[alias]:c||(b[alias]=a[alias]);this._count();return this},load:function(c,b){c=c||!1;if(b= b||!1)if("function"==typeof this["_"+c])this["_"+c](b);else this._loaded[c]=b;return this},_holidays:function(c){var c=c&&c.length?c:[],b=0,a=c.length,d=[],e=null;this._loaded.holidays=e={};for(b=0;b<a;b++)d=c[b].split("-"),d[1]-=1,d[2]-=0,d=d.join("-"),e[d]=!0;return this},show:function(c,b,a){a=a||!1;b=b||!1;c=c||!1;"string"==typeof c&&(a=c,c=null);a&&(this._id=a);this._draw(c);this._nodes.cal.className="b-cal b-cal_is_visible"+(this._id?" b-cal_id_"+this._id:"");this.shown=!0;b&&(this._nodes.cal.style.top= b.y+"px",this._nodes.cal.style.left=b.x+"px");return this},hide:function(){this._nodes.cal.className="b-cal";this.shown=!1;return this},prev:function(){var c=this._data.prev;c&&this.show({now:new Date(c.year,c.month,1)},!1,this._id);return this},next:function(){var c=this._data.next;c&&this.show({now:new Date(c.year,c.month,1)},!1,this._id);return this},min:function(){var c=this._stable.min;return new Date(c.getFullYear(),c.getMonth(),c.getDate()+1)},max:function(){var c=this._stable.max;return new Date(c.getFullYear(), c.getMonth(),c.getDate()-1)}};window.OAF?window.OAF.prototype.modules.Cal=i:window.Cal=i})();