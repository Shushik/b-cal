/**
 * @author      Shushik <silkleopard@yandex.ru>
 * @version     1.0 (min)
 * @description b-cal â€” a simple JavaScript/CSS calendar
 */
;(function(o){var i=function(c,b,a,d){this._lang={week:"Mo,Tu,We,Th,Fr,Sa,Su".split(","),month:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),hide:"hide"};this._data={prev:null,curr:null,next:null};this._stable={min:null,max:null,now:null};this._moving={min:null,max:null,now:null};this._nodes={cal:null,days:null,prev:null,next:null,tail:null,month:null,target:null};this._handlers={click:function(){}};this.init(c,b,a,d);return this};i.prototype={init:function(c, b,a,d){var b=b||!1,c=c||{},a=a||document.body,d=d||{},f="";this._nodes.target=a;if(b)for(f in this._lang)this._lang[f]=b[f];for(f in d)this._handlers[f]=d[f];this.preset(c)._create();return this},_inside:function(c,b,a){return c>b&&c<a?!0:!1},_count:function(){var c=42,b=null,a=null,a=null;this._data.prev=null;this._data.next=null;b=this._data.curr={};b.raw=new Date(this._moving.now);b.month=b.raw.getMonth();b.year=b.raw.getFullYear();b.till=(new Date(b.year,b.month+1,0)).getDate();b.from=1;b.beg= (new Date(b.year,b.month,1)).getDay();b.end=(new Date(b.year,b.month,b.till)).getDate();0==b.beg&&(b.beg=7);c-=b.till;a=this._data.prev={};a.raw=new Date(b.year,b.month-1);a.month=a.raw.getMonth();a.year=a.raw.getFullYear();a.till=(new Date(a.year,b.month,0)).getDate();a.from=a.till-(b.beg-2);c-=b.beg;a=this._data.next={};a.raw=new Date(b.year,b.month+1);a.month=a.raw.getMonth();a.year=a.raw.getFullYear();a.till=c+1;a.from=1;return this},_create:function(){var c=0,b="",a=null,d=null,f=this,j=null, e=null,h=null,d=document.createElement("div");d.className="b-cal__tail-in";j=document.createElement("div");j.className="b-cal__tail-out";e=document.createElement("div");e.className="b-cal__hide";e.innerHTML=this._lang.hide;a=this._nodes.cal=document.createElement("div");a.className="b-cal";this._nodes.prev=document.createElement("div");this._nodes.prev.className="b-cal__prev";this._nodes.next=document.createElement("div");this._nodes.next.className="b-cal__next";this._nodes.month=document.createElement("div"); this._nodes.month.className="b-cal__month";this._nodes.days=document.createElement("div");this._nodes.days.className="b-cal__days";this._nodes.week=document.createElement("div");this._nodes.week.className="b-cal__weekdays";for(c=0;7>c;c++)h=document.createElement("li"),h.className="b-cal__weekday",h.innerHTML=this._lang.week[c],this._nodes.week.appendChild(h);a.appendChild(j);a.appendChild(d);a.appendChild(this._nodes.month);a.appendChild(this._nodes.prev);a.appendChild(this._nodes.next);a.appendChild(this._nodes.week); a.appendChild(this._nodes.days);a.appendChild(e);this._nodes.target.appendChild(a);for(b in this._handlers)a.addEventListener?a.addEventListener(b,function(a){f._live(b,a)}):a.attachEvent&&a.attachEvent("on"+b,function(){f._live(b,window.event)});return this},_draw:function(c){this.set(c||!1);var b=!1,c=!1,a=0,d=0,f=0,j=this._lang,e=this._data,b=e.prev,h=e.curr,e=e.next,a=this._moving,i=this._stable,k=a.min,l=a.max,g=this._nodes,m=h.year,n=h.month;g.days.innerHTML="";g.month.innerHTML=j.month[h.month]+ " "+h.year;i.now.getFullYear()==m&&i.now.getMonth()==n&&(f=i.now.getDate());a.chosen&&a.chosen.month==n&&a.chosen.year==m&&(d=a.chosen.day);if(1<h.beg)for(a=b.from;a<=b.till;a++)node=document.createElement("div"),node.innerHTML=a,this._inside(new Date(b.year,b.month,a),k,l)?(c=!0,node.className="b-cal__day b-cal__day_in_past"):node.className="b-cal__day b-cal__day_is_disabled",g.days.appendChild(node);else this._inside(new Date(b.year,b.month,b.from),k,l)&&(c=!0);c?(g.prev.title=j.month[b.month]+ " "+b.year,g.prev.className="b-cal__prev",c=!1):(g.prev.title="",g.prev.className="b-cal__prev b-cal__prev_is_disabled");for(a=h.from;a<=h.till;a++)node=document.createElement("div"),b=this._inside(new Date(m,n,a),k,l),node.innerHTML=a,node.className=d==a?"b-cal__day b-cal__day_is_chosen":f==a?"b-cal__day b-cal__day_in_presence":b?"b-cal__day":"b-cal__day b-cal__day_is_disabled",g.days.appendChild(node);if(0<e.till)for(a=e.from;a<=e.till;a++)node=document.createElement("div"),node.innerHTML=a,this._inside(new Date(e.year, e.month,a),k,l)?(c=!0,node.className="b-cal__day b-cal__day_in_future"):node.className="b-cal__day b-cal__day_is_disabled",g.days.appendChild(node);c?(g.next.title=j.month[e.month]+" "+e.year,g.next.className="b-cal__next"):(g.next.title="",g.next.className="b-cal__next b-cal__next_is_disabled")},_live:function(c,b){b.srcElement&&(b.target=b.srcElement);3==b.target.nodeType&&(b.target=b.target.parentNode);var a=this._data.curr,d=b.target,f=d.className,d=d.innerHTML;if(f)switch(f){case "b-cal__prev":case "b-cal__day b-cal__day_in_past":this.prev(); break;case "b-cal__next":case "b-cal__day b-cal__day_in_future":this.next();break;case "b-cal__hide":this.set().hide();break;case "b-cal__day":case "b-cal__day b-cal__day_in_presence":this._handlers.click(b.target,b,new Date(a.year,a.month,d)),this._moving.chosen={year:a.year,month:a.month,day:d},this._draw({now:new Date(a.year,a.month,d)})}},preset:function(c){var c=c||{},b=[],a={now:new Date,min:null,max:null};a.min=new Date(a.now.getFullYear(),a.now.getMonth(),a.now.getDate()-1);a.max=new Date(a.now.getFullYear()+ 1,a.now.getMonth(),a.now.getDate());for(alias in this._stable)c[alias]?(b=c[alias].split(" "),this._stable[alias]=new Date(b[0],b[1]-1,b[2])):this._stable[alias]=a[alias];return this},reset:function(){return this.set()},set:function(c){var b=this._moving,a=this._stable,d=c||{};!c&&b.chosen&&delete b.chosen;for(alias in b)d[alias]?b[alias]=d[alias]:c||(b[alias]=a[alias]);this._count();return this},show:function(c,b){b=b||!1;this._draw(c||!1);this._nodes.cal.className="b-cal b-cal_is_visible";b&&(this._nodes.cal.style.top= b.y+"px",this._nodes.cal.style.left=b.x+"px");return this},hide:function(){this._nodes.cal.className="b-cal";return this},prev:function(){var c=this._data.prev;c&&this.show({now:new Date(c.year,c.month,1)});return this},next:function(){var c=this._data.next;c&&this.show({now:new Date(c.year,c.month,1)});return this},min:function(){return this._stable.min},max:function(){return this._stable.max}};o?cpase.Cal=i:window.Cal=i})();