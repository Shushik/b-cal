/**
 * @author      Shushik <silkleopard@yandex.ru>
 * @version     1.0 (min)
 * @description b-cal â€” a simple JavaScript/CSS calendar
 */
;(function(d){var d=d||!1,j=function(c,b,a,h){this._lang={week:"Mo,Tu,We,Th,Fr,Sa,Su".split(","),month:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),hide:"hide"};this._data={prev:null,curr:null,next:null};this._stable={min:null,max:null,now:null};this._moving={min:null,max:null,now:null};this._nodes={cal:null,days:null,prev:null,next:null,tail:null,month:null,target:null};this._handlers={click:function(){}};this.init(c,b,a,h);return this};j.prototype= {init:function(c,b,a,h){var b=b||!1,c=c||{},a=a||document.body,h=h||{},d="";this._nodes.target=a;if(b)for(d in this._lang)this._lang[d]=b[d];for(d in h)this._handlers[d]=h[d];this.preset(c)._create();return this},_inside:function(c,b,a){return c>b&&c<a?!0:!1},_count:function(){var c=42,b=null,a=null,a=null;this._data.prev=null;this._data.next=null;b=this._data.curr={};b.raw=new Date(this._moving.now);b.month=b.raw.getMonth();b.year=b.raw.getFullYear();b.till=(new Date(b.year,b.month+1,0)).getDate(); b.from=1;b.beg=(new Date(b.year,b.month,1)).getDay();b.end=(new Date(b.year,b.month,b.till)).getDate();0==b.beg&&(b.beg=7);c-=b.till;a=this._data.prev={};a.raw=new Date(b.year,b.month-1);a.month=a.raw.getMonth();a.year=a.raw.getFullYear();a.till=(new Date(a.year,b.month,0)).getDate();a.from=a.till-(b.beg-2);c-=b.beg;a=this._data.next={};a.raw=new Date(b.year,b.month+1);a.month=a.raw.getMonth();a.year=a.raw.getFullYear();a.till=c+1;a.from=1;return this},_create:function(){var c=0,b="",a=null,d=null, i=this,k=null,e=null,g=null,d=document.createElement("div");d.className="b-cal__tail-in";k=document.createElement("div");k.className="b-cal__tail-out";e=document.createElement("div");e.className="b-cal__hide";e.innerHTML=this._lang.hide;a=this._nodes.cal=document.createElement("div");a.className="b-cal";this._nodes.prev=document.createElement("div");this._nodes.prev.className="b-cal__prev";this._nodes.next=document.createElement("div");this._nodes.next.className="b-cal__next";this._nodes.month=document.createElement("div"); this._nodes.month.className="b-cal__month";this._nodes.days=document.createElement("div");this._nodes.days.className="b-cal__days";this._nodes.week=document.createElement("div");this._nodes.week.className="b-cal__weekdays";for(c=0;7>c;c++)g=document.createElement("li"),g.className="b-cal__weekday",g.innerHTML=this._lang.week[c],this._nodes.week.appendChild(g);a.appendChild(k);a.appendChild(d);a.appendChild(this._nodes.month);a.appendChild(this._nodes.prev);a.appendChild(this._nodes.next);a.appendChild(this._nodes.week); a.appendChild(this._nodes.days);a.appendChild(e);this._nodes.target.appendChild(a);for(b in this._handlers)a.addEventListener?a.addEventListener(b,function(a){i._live(b,a)}):a.attachEvent&&a.attachEvent("on"+b,function(){i._live(b,window.event)});return this},_draw:function(c){this.set(c||!1);var b=!1,c=!1,a=0,h=0,i=0,k=this._lang,e=this._data,b=e.prev,g=e.curr,e=e.next,a=this._moving,j=this._stable,l=a.min,m=a.max,f=this._nodes,n=g.year,o=g.month;f.days.innerHTML="";f.month.innerHTML=k.month[g.month]+ " "+g.year;j.now.getFullYear()==n&&j.now.getMonth()==o&&(i=j.now.getDate());a.chosen&&a.chosen.month==o&&a.chosen.year==n&&(h=a.chosen.day);if(1<g.beg)for(a=b.from;a<=b.till;a++)d=document.createElement("div"),d.innerHTML=a,this._inside(new Date(b.year,b.month,a),l,m)?(c=!0,d.className="b-cal__day b-cal__day_in_past"):d.className="b-cal__day b-cal__day_is_disabled",f.days.appendChild(d);else this._inside(new Date(b.year,b.month,b.from),l,m)&&(c=!0);c?(f.prev.title=k.month[b.month]+" "+b.year,f.prev.className= "b-cal__prev",c=!1):(f.prev.title="",f.prev.className="b-cal__prev b-cal__prev_is_disabled");for(a=g.from;a<=g.till;a++)d=document.createElement("div"),b=this._inside(new Date(n,o,a),l,m),d.innerHTML=a,d.className=h==a?"b-cal__day b-cal__day_is_chosen":i==a?"b-cal__day b-cal__day_in_presence":b?"b-cal__day":"b-cal__day b-cal__day_is_disabled",f.days.appendChild(d);if(0<e.till)for(a=e.from;a<=e.till;a++)d=document.createElement("div"),d.innerHTML=a,this._inside(new Date(e.year,e.month,a),l,m)?(c=!0, d.className="b-cal__day b-cal__day_in_future"):d.className="b-cal__day b-cal__day_is_disabled",f.days.appendChild(d);c?(f.next.title=k.month[e.month]+" "+e.year,f.next.className="b-cal__next"):(f.next.title="",f.next.className="b-cal__next b-cal__next_is_disabled")},_live:function(c,b){b.srcElement&&(b.target=b.srcElement);3==b.target.nodeType&&(b.target=b.target.parentNode);var a=this._data.curr,d=b.target,i=d.className,d=d.innerHTML;if(i)switch(i){case "b-cal__prev":case "b-cal__day b-cal__day_in_past":this.prev(); break;case "b-cal__next":case "b-cal__day b-cal__day_in_future":this.next();break;case "b-cal__hide":this.set().hide();break;case "b-cal__day":case "b-cal__day b-cal__day_in_presence":this._handlers.click(b.target,b,new Date(a.year,a.month,d)),this._moving.chosen={year:a.year,month:a.month,day:d},this._draw({now:new Date(a.year,a.month,d)})}},preset:function(c){var c=c||{},b=[],a={now:new Date,min:null,max:null};a.min=new Date(a.now.getFullYear(),a.now.getMonth(),a.now.getDate()-1);a.max=new Date(a.now.getFullYear()+ 1,a.now.getMonth(),a.now.getDate());for(alias in this._stable)c[alias]?(b=c[alias].split(" "),this._stable[alias]=new Date(b[0],b[1]-1,b[2])):this._stable[alias]=a[alias];return this},reset:function(){return this.set()},set:function(c){var b=this._moving,a=this._stable,d=c||{};!c&&b.chosen&&delete b.chosen;for(alias in b)d[alias]?b[alias]=d[alias]:c||(b[alias]=a[alias]);this._count();return this},show:function(c,b){b=b||!1;this._draw(c||!1);this._nodes.cal.className="b-cal b-cal_is_visible";b&&(this._nodes.cal.style.top= b.y+"px",this._nodes.cal.style.left=b.x+"px");return this},hide:function(){this._nodes.cal.className="b-cal";return this},prev:function(){var c=this._data.prev;c&&this.show({now:new Date(c.year,c.month,1)});return this},next:function(){var c=this._data.next;c&&this.show({now:new Date(c.year,c.month,1)});return this},min:function(){return this._stable.min},max:function(){return this._stable.max}};space?cpase.Cal=j:window.Cal=j})(space);